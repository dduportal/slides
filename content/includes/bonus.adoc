= Bonus

= REST API documentation

* To learn more:  ðŸ“–
** https://wiki.jenkins.io/display/JENKINS/Remote+access+API
** https://wiki.jenkins.io/display/JENKINS/Authenticating+scripted+clients

= BONUS - how to retrieve a token

[source,bash]
----
# First thing we do is obtain a crumb from cjoc, this allows us to call the rest API without having to disable CSRF.
JENKINS_CRUMB=$( \
  curl --user $USERNAME:$PASSWORD \
       --silent "$URL/cjoc/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\":\",//crumb)" \
)

# Get the JSON payload from the generateNewToken API
JENKINS_TOKENS_JSON=$( \
  curl --header "$JENKINS_CRUMB" \
       --user $USERNAME:$PASSWORD \
       --silent "$URL/cjoc/user/$USERNAME/descriptorByName/jenkins.security.ApiTokenProperty/generateNewToken" \
       --data "newTokenName=$USERNAME" \
)

# Pulls the token out of the JSON payload.
JENKINS_TOKEN=$( \
  echo $JENKINS_TOKENS_JSON | jq '.data.tokenValue' \
)

# Running Sed to get trim quotes from the output and returns it.
sed -e 's/^"//' -e 's/"$//' <<<"$JENKINS_TOKEN"
----


= Jenkins CLI - More details

* https://jenkins.io/doc/book/managing/cli/

= Groovy Scripts

** See this link:https://support.cloudbees.com/hc/en-us/articles/228175367-Custom-Plugins-APIs-and-Javadocs-of-CloudBees-Jenkins-Enterprise-plugins[_Knowledge Base article_,window=_blank] on how to access the javadocs

= JCasC

* https://github.com/jenkinsci/configuration-as-code-plugin

= Bootstrap strategy

[.small]
* see example on *https://github.com/jmMeessen/captains_aws_cjp*

{nbsp} +

. Install jenkins configuration file (startup option)
.. JAVA_ARGS -> `-Djenkins.install.runSetupWizard=false`
. Proceed with installation via package manager (`apt-get`)
. Create `init.groovy.d` directory
. Replace the instanceID with know one (`secret.key`)

= Bootstrap strategy (cont.)

. Add "init groovy scripts" in directory
.. Initial security settings 
.. License loading script
.. Set-URL, JNLP, and SSHD Port configuration scripts
.. Create Cfg-Management user, generate key and load public key
. Restart CJOC to activate scripts
. Use CLI to install plugins
. Use CLI to execute groovy to create Client Master

= Bootstrap strategy (cont.)

. Configure Client Master in same principle
.. Add to JAVA_ARGS the connection info
.. Configure security and initial users via init scripts
.. Install default plugins
. Configure JCasC environment
. Copy definition in adequate directory
. Use CLI to force the load of configuration


